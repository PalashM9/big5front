<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Webis Psych</title>
      <script src="https://cdn.tailwindcss.com"></script>
      <style>
         .skeleton{background:linear-gradient(90deg,#e0e0e0 25%,#f5f5f5 50%,#e0e0e0 75%);background-size:200% 100%;animation:1.5s infinite loading;height:20px;border-radius:5px}@keyframes loading{0%{background-position:100% 0}100%{background-position:-100% 0}}.hidden{display:none}.loader-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,.8);display:flex;justify-content:center;align-items:center;z-index:1000}.spinner{border:4px solid rgba(0,0,0,.1);width:40px;height:40px;border-radius:50%;border-left-color:#3498db;animation:1s linear infinite spin}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.notif-one,.notif-two{position:absolute;top:5%;right:2%; max-width: 200px;}.notif-two{top:calc(5% + 25%)}.steps{margin:10px 0 5px}
         .fade-out {
         opacity: 0;
         transition: opacity 0.5s ease;
         pointer-events: none;
         }
         .fade-in {
         opacity: 0;
         animation: fadeIn 0.6s forwards;
         }
         @keyframes fadeIn {
         to {
         opacity: 1;
         }
         }
         .tooltip-container {
      position: relative;
      display: inline-block;
    }
    .tooltip-text {
      position: absolute;
      top: 125%;
      left: 50%;
      transform: translateX(-50%);
      background-color: white;
      color: #4b5563;
      padding: 0.75rem;
      font-size: 0.875rem;
      max-width: 90vw;
      width: 16rem;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 10;
    }
    .tooltip-container:hover .tooltip-text {
      opacity: 1;
      pointer-events: auto;
    }
      </style>
   </head>
   <body class="bg-gray-100 flex justify-center items-center min-h-screen text-sm">
    <div id="loader" class="loader-overlay hidden">
        <div class="spinner"></div>
      </div>
    
      <!-- Fake Loader Steps -->
      <div id="fakeLoader" class="hidden bg-white p-8 rounded-lg shadow-md w-full max-w-2xl text-sm">
        <h2 class="text-xl font-bold mb-4">Preparing your experience...</h2>
        <div id="stepMessages" class="space-y-2 font-mono text-gray-700"></div>
      </div>
    
      <!-- Welcome Screen -->
      <div id="welcomeScreen" class="bg-white p-8 rounded-lg shadow-md w-full max-w-2xl">
        <h1 class="text-2xl font-bold mb-4">Psych Bot Personality References</h1>
        <p class="text-gray-600 mb-6">Enter your name to begin:</p>
        <input type="text" id="name" class="w-full border p-2 rounded mb-4" placeholder="Enter your name">
        <button onclick="setUserName()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Start</button>
      </div>
    
      <!-- Tips -->
      <div class="p-4 mb-4 text-sm text-blue-800 rounded-lg bg-blue-50 dark:bg-gray-800 dark:text-blue-400 notif-one hidden" role="alert" id="notif-one">
        <span class="font-medium">#Tip 1: Please take your time to review all the options in the question dropdown.</span>
      </div>
      <div class="p-4 mb-4 text-sm text-blue-800 rounded-lg bg-blue-50 dark:bg-gray-800 dark:text-blue-400 notif-two hidden" role="alert" id="notif-two">
        <span class="font-medium">#Tip 2: Avoid stopping at the first relevant option. Exploring all choices can provide deeper insights.</span>
      </div>
    
      <!-- Main Survey -->
      <div id="mainSurvey" class="hidden bg-white p-8 rounded-lg shadow-md w-full max-w-2xl">
        <div class="flex justify-between items-center mb-6">
            <p id="progress" class="text-gray-600">Progress: <span id="progressCount">1</span> / <span id="totalQuestions"></span></p>
            <button onclick="document.getElementById('exampleModal').classList.remove('hidden')" class="text-sm text-blue-600 hover:underline">View Example</button>
        </div>
    
        <!-- Step 1 -->
        <h1 class="text-2xl font-bold mb-3 mt-2">
          Step 1. Carefully read the user's statement to understand their situation.
          <span class="tooltip-container text-blue-500 font-bold text-lg cursor-pointer ml-1">?
            <div class="tooltip-text w-64">
              Imagine a close friend sharing this with you during a vulnerable moment. Try to feel what they might be going through. Your role is to understand, not judge.
            </div>
          </span>
        </h1>
        <label class="block font-semibold mb-2 mt-2 italic">User Statement:</label>
        <div id="patientSkeleton" class="skeleton w-full h-10 mb-4"></div>
        <p id="patientStatement" class="bg-gray-200 p-3 rounded mb-4 hidden"></p>
    
        <hr>
    
        <!-- Step 2 -->
        <h1 class="text-2xl font-bold mb-3 mt-4">
          Step 2. Select the topic that most closely aligns with the user statement's context.
          <span class="tooltip-container text-blue-500 font-bold text-lg cursor-pointer ml-1">?
            <div class="tooltip-text w-64">
              Think about what your friend is really talking about. Is it loneliness, self-worth, past trauma, or something else?
            </div>
          </span>
        </h1>
        <label class="block font-semibold mb-2 hidden italic" id="categoryLabel">
          Topics :
          <span class="tooltip-container text-blue-500 font-bold text-lg cursor-pointer ml-1">?
            <div class="tooltip-text w-96">
              <p class="mb-2"><strong>Think of the topics like this :</strong></p>
              <ul class="list-disc list-inside space-y-1">
                <li><strong>Exploration and Creativity:</strong> They're expressing curiosity, imagination, or artistic thoughts.</li>
                <li><strong>Analytical and Problem-Solving Skills:</strong> They're trying to understand, fix, or rationalize a situation.</li>
                <li><strong>Organization and Responsibility:</strong> It's about duty, discipline, structure, or managing life tasks.</li>
                <li><strong>Emotional and Psychological States:</strong> They're describing how they feel inside mentally or emotionally.</li>
                <li><strong>Social Interactions and Relationships:</strong> It‚Äôs about friends, family, partners, or communication issues.</li>
              </ul>
            </div>
          </span>
        </label>
        <div id="categorySkeleton" class="skeleton w-full h-10 mb-4"></div>
        <select id="category" class="w-full border p-2 rounded mb-4 hidden" onchange="fetchQuestions()">
          <option value="">Select a topic</option>
        </select>
    
        <hr>
    
        <!-- Step 3 -->
        <h1 class="text-2xl font-bold mb-3 mt-4">
          Step 3. Choose a follow-up question to keep the conversation going.
          <span class="tooltip-container text-blue-500 font-bold text-lg cursor-pointer ml-1">?
            <div class="tooltip-text w-64">
              If your friend just said this to you, what would you gently ask next to help them open up more?
            </div>
          </span>
        </h1>
        <label class="block font-semibold mb-2 hidden italic" id="questionLabel">Select the question that you believe will encourage the user to open up more about the topic:</label>
        <div id="questionSkeleton" class="skeleton w-full h-10 mb-4"></div>
        <select id="question" class="w-full border p-2 rounded mb-4 hidden" required>
          <option value="">Select a question</option>
        </select>
    
        <!-- Step 4 -->
        <h1 class="text-2xl font-bold mb-3 mt-4">Step 4. Share your feedback (optional)</h1>
        <label class="block font-semibold mb-2 italic">If you were unsure, confused, or found a particular question really helpful, let us know why. Your feedback helps us improve how this system thinks.:</label>
        <textarea id="feedback" class="w-full border p-2 rounded mb-4" placeholder="Your thoughts..."></textarea>
    
        <button onclick="submitResponse()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Next</button>
      </div>
    
      <!-- Thank You Message -->
      <div id="thankYou" class="hidden bg-white p-8 rounded-lg shadow-md w-full max-w-2xl text-center">
        <h1 class="text-2xl font-bold mb-4">Thank You!</h1>
        <p class="text-gray-600">Thanks for supporting this research. Your responses have been recorded.</p>
        <div class="animate-bounce mt-4">üôè</div>
      </div>

      <div id="exampleModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg max-w-lg w-full relative">
          <button onclick="document.getElementById('exampleModal').classList.add('hidden')" class="absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-xl">&times;</button>
          <h2 class="text-xl font-bold mb-2">Example Statement & Best Question</h2>
          <p class="text-sm italic mb-3">
            <span>User Statement:</span>
            <span>"People who are parental figures in my life have, in the past, hurt me, and some continue to do so. It makes me feel like I'm not good enough for my husband or the life he provides me. I have had jobs, but I am going through a lot of my past garbage and trying to figure out when it all went wrong. Any time I bring these things up, I am expected to be over the issue. These are people that you can't just cut out, but I have never received apologies for so much of my pain. I don't know what to do any more. I don't know who I am anymore."</span>
          </p>
          <p class="text-sm mb-2">
            <strong>Correct Topic:</strong> Emotional and Psychological States
          </p>
          <p class="text-sm mb-2">
            <strong>Best Follow-up Question:</strong><br>
            ‚ÄúDo you feel that you are someone who often feels insecure?‚Äù
          </p>
          <p class="text-sm text-gray-600">
            <strong>Why?</strong><br>
            This question aligns best because the user expresses deep emotional vulnerability and confusion about their self-worth. It invites them to reflect gently on the core of their pain without being intrusive.
          </p>
        </div>
      </div>
      <script>
         let patientStatements = [],
           currentIndex = 0,
           userName = localStorage.getItem("current_user") || "",
           patientReadStartTime = null,
           questionOpenTime = null;
         
         function shuffleArray(array) {
           for (let i = array.length - 1; i > 0; i--) {
             const j = Math.floor(Math.random() * (i + 1));
             [array[i], array[j]] = [array[j], array[i]];
           }
         }
         
         async function setUserName() {
           userName = document.getElementById("name").value;
         
           if (!userName) {
             alert("Please enter your name");
             return;
           }
         
           localStorage.setItem("current_user", userName);
           const welcome = document.getElementById("welcomeScreen");
           welcome.classList.add("fade-out");
           setTimeout(() => {
           welcome.classList.add("hidden");
           showFakeLoadingSteps(userName, async () => {
             await fetch("https://big5-wish.onrender.com/set_user", {
               method: "POST",
               headers: { "Content-Type": "application/json" },
               body: JSON.stringify({ name: userName })
             });
         
             document.getElementById("mainSurvey").classList.remove("hidden");
             loadPatientStatements();
           });
         }, 500);
           
         }
         
         function showFakeLoadingSteps(username, callback) {
           const steps = [
             `Initializing Session For ${username}...`,
             "Fetching Topic Modules...",
             "Loading User Statements...",
             "Finalizing Interface..."
           ];
         
           const stepContainer = document.getElementById("stepMessages");
           const fakeLoader = document.getElementById("fakeLoader");
         
           document.getElementById("loader").classList.add("hidden");
           fakeLoader.classList.remove("hidden");
         
           let index = 0;
         
           function showNextStep() {
             if (index > 0) {
               stepContainer.children[index - 1].innerHTML = `‚úÖ ${steps[index - 1]}`;
             }
         
             if (index < steps.length) {
               const stepLine = document.createElement("div");
               stepLine.innerHTML = `üîÑ ${steps[index]}`;
               stepContainer.appendChild(stepLine);
               index++;
               setTimeout(showNextStep, 1200);
             } else {
                 fakeLoader.classList.add("fade-out");
               setTimeout(() => {
                 fakeLoader.classList.add("hidden");
                 callback();
               }, 1000);
             }
           }
         
           stepContainer.innerHTML = "";
           showNextStep();
         }
         
         async function loadPatientStatements() {
           const response = await fetch("https://big5-wish.onrender.com/get_patient_statements");
           const data = await response.json();
           patientStatements = data.patient_statements;
           shuffleArray(patientStatements);
           document.getElementById("notif-one").classList.remove("hidden");
           document.getElementById("notif-two").classList.remove("hidden");
           document.getElementById("totalQuestions").textContent = patientStatements.length;
           updateStatement();
         }
         
         function updateStatement() {
           document.getElementById("loader").classList.add("hidden");
         
           if (currentIndex < patientStatements.length) {
             document.getElementById("patientSkeleton").classList.remove("hidden");
             document.getElementById("categorySkeleton").classList.remove("hidden");
             document.getElementById("questionSkeleton").classList.remove("hidden");
             document.getElementById("patientStatement").classList.add("hidden");
             document.getElementById("categoryLabel").classList.add("hidden");
             document.getElementById("category").classList.add("hidden");
             document.getElementById("questionLabel").classList.add("hidden");
             document.getElementById("question").classList.add("hidden");
         
             setTimeout(() => {
               document.getElementById("patientSkeleton").classList.add("hidden");
               document.getElementById("patientStatement").classList.remove("hidden");
               document.getElementById("patientStatement").textContent = patientStatements[currentIndex];
               document.getElementById("progressCount").textContent = currentIndex + 1;
               patientReadStartTime = new Date();
               fetchCategories();
             }, 300);
           } else {
             document.getElementById("mainSurvey").classList.add("hidden");
             document.getElementById("thankYou").classList.remove("hidden");
           }
         }
         
         async function fetchCategories() {
           const response = await fetch("https://big5-wish.onrender.com/get_categories", {
             method: "POST"
           });
           const data = await response.json();
           const categorySelect = document.getElementById("category");
           categorySelect.innerHTML = '<option value="">Select a topic</option>';
         
           data.categories.forEach(category => {
             const option = document.createElement("option");
             option.value = category;
             option.textContent = category;
             categorySelect.appendChild(option);
           });
         
           setTimeout(() => {
             document.getElementById("categorySkeleton").classList.add("hidden");
             document.getElementById("categoryLabel").classList.remove("hidden");
             categorySelect.classList.remove("hidden");
           }, 1500);
         }
         
         async function fetchQuestions() {
           const selectedCategory = document.getElementById("category").value;
           if (!selectedCategory) return;
         
           document.getElementById("questionSkeleton").classList.remove("hidden");
           document.getElementById("question").classList.add("hidden");
           document.getElementById("questionLabel").classList.add("hidden");
         
           const response = await fetch("https://big5-wish.onrender.com/get_questions", {
             method: "POST",
             headers: { "Content-Type": "application/json" },
             body: JSON.stringify({ category: selectedCategory })
           });
           const data = await response.json();
           const questionSelect = document.getElementById("question");
           questionSelect.innerHTML = '<option value="">Select a question</option><option value="not_sure">I am not sure</option>';
           shuffleArray(data.questions);
         
           data.questions.forEach(question => {
             const option = document.createElement("option");
             option.value = question;
             option.textContent = question;
             questionSelect.appendChild(option);
           });
         
           setTimeout(() => {
             document.getElementById("questionSkeleton").classList.add("hidden");
             document.getElementById("questionLabel").classList.remove("hidden");
             questionSelect.classList.remove("hidden");
           }, 1500);
         }
         
         async function submitResponse() {
           const category = document.getElementById("category").value;
           const question = document.getElementById("question").value;
           const name = localStorage.getItem("current_user");
           const feedback = document.getElementById("feedback").value || "";
         
           if (!name) {
             alert("User name is missing! Please refresh and re-enter your name.");
             return;
           }
           if (!category || !question) {
             alert("Please select a category and a question before proceeding.");
             return;
           }
         
           let responseTime = 0;
           if (patientReadStartTime) {
             responseTime = (new Date() - patientReadStartTime) / 1000;
             localStorage.setItem("read_to_response_time", responseTime.toFixed(2));
             patientReadStartTime = null;
           }
         
           const dropdownTime = localStorage.getItem("question_selection_time") || "";
         
           const response = await fetch("https://big5-wish.onrender.com/submit_response", {
             method: "POST",
             headers: { "Content-Type": "application/json" },
             body: JSON.stringify({
               name,
               patient_statement: patientStatements[currentIndex],
               category,
               selected_question: question,
               dropdown_time: dropdownTime,
               response_time: responseTime.toFixed(2),
               feedback
             })
           });
         
           const data = await response.json();
           if (data.success) {
             currentIndex++;
             updateStatement();
             document.getElementById("feedback").value = "";
           } else {
             alert("Error submitting response: " + data.message);
           }
         }
         
         const questionDropdown = document.getElementById("question");
         questionDropdown.addEventListener("mousedown", () => {
           questionOpenTime = new Date();
         });
         questionDropdown.addEventListener("change", () => {
           if (questionOpenTime) {
             const timeTaken = (new Date() - questionOpenTime) / 1000;
             localStorage.setItem("question_selection_time", timeTaken.toFixed(2));
             questionOpenTime = null;
           }
         });
             
      </script>
   </body>
</html>