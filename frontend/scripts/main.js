let patientStatements=[],currentIndex=0,userName=localStorage.getItem("current_user")||"",patientReadStartTime=null,questionOpenTime=null;function shuffleArray(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}async function setUserName(){if(userName=document.getElementById("name").value,!userName)return void alert("Please enter your name");localStorage.setItem("current_user",userName);const e=document.getElementById("welcomeScreen");e.classList.add("fade-out"),setTimeout((()=>{e.classList.add("hidden"),showFakeLoadingSteps(userName,(()=>{document.getElementById("mainSurvey").classList.remove("hidden"),setMeme(),loadPatientStatements()}))}),500)}function showFakeLoadingSteps(e,t){const n=[`Initializing Session For ${e}...`,"Fetching Topic Modules...","Loading User Statements...","Finalizing Interface... < 2 minutes"],s=document.getElementById("stepMessages"),o=document.getElementById("fakeLoader");document.getElementById("loader").classList.add("hidden"),o.classList.remove("hidden"),s.innerHTML="";let a=0;async function i(t,s){try{if((await fetch("https://big5-wish.onrender.com/set_user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})})).ok)return t.innerHTML=`✅ ${n[a]}`,o.classList.add("fade-out"),void setTimeout((()=>{o.classList.add("hidden"),s()}),800)}catch(e){}setTimeout((()=>i(t,s)),1500)}!function e(){a>0&&(s.children[a-1].innerHTML=`✅ ${n[a-1]}`);const o=document.createElement("div");o.innerHTML=`<span class="inline-block w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mr-2"></span> ${n[a]}`,s.appendChild(o),a===n.length-1?i(o,t):(a++,setTimeout(e,1200))}()}async function loadPatientStatements(){const e=await fetch("https://big5-wish.onrender.com/get_patient_statements"),t=await e.json();patientStatements=t.patient_statements,shuffleArray(patientStatements),document.getElementById("notif-one").classList.remove("hidden"),document.getElementById("notif-two").classList.remove("hidden"),document.getElementById("totalQuestions").textContent=patientStatements.length,updateStatement()}function updateStatement(){document.getElementById("loader").classList.add("hidden"),currentIndex<patientStatements.length?(document.getElementById("patientSkeleton").classList.remove("hidden"),document.getElementById("categorySkeleton").classList.remove("hidden"),document.getElementById("questionSkeleton").classList.remove("hidden"),document.getElementById("patientStatement").classList.add("hidden"),document.getElementById("categoryLabel").classList.add("hidden"),document.getElementById("category").classList.add("hidden"),document.getElementById("questionLabel").classList.add("hidden"),document.getElementById("question").classList.add("hidden"),setTimeout((()=>{document.getElementById("patientSkeleton").classList.add("hidden"),document.getElementById("patientStatement").classList.remove("hidden"),document.getElementById("patientStatement").textContent=patientStatements[currentIndex],document.getElementById("progressCount").textContent=currentIndex+1,patientReadStartTime=new Date,fetchCategories()}),300)):(document.getElementById("mainSurvey").classList.add("hidden"),document.getElementById("notif-one").classList.add("hidden"),document.getElementById("notif-two").classList.add("hidden"),document.getElementById("thankYou").classList.remove("hidden"))}async function fetchCategories(){const e=await fetch("https://big5-wish.onrender.com/get_categories",{method:"POST"}),t=await e.json(),n=document.getElementById("category");n.innerHTML='<option value="">Select a topic</option>',t.categories.forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)})),setTimeout((()=>{document.getElementById("categorySkeleton").classList.add("hidden"),document.getElementById("categoryLabel").classList.remove("hidden"),n.classList.remove("hidden")}),1500)}async function fetchQuestions(){const e=document.getElementById("category").value;if(!e)return;document.getElementById("questionSkeleton").classList.remove("hidden"),document.getElementById("question").classList.add("hidden"),document.getElementById("questionLabel").classList.add("hidden");const t=await fetch("https://big5-wish.onrender.com/get_questions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:e})}),n=await t.json(),s=document.getElementById("question");s.innerHTML='\n    <option value="">Select a question</option>\n    <option value="not_sure">I am not sure</option>\n  ',shuffleArray(n.questions),n.questions.forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,s.appendChild(t)})),setTimeout((()=>{document.getElementById("questionSkeleton").classList.add("hidden"),document.getElementById("questionLabel").classList.remove("hidden"),s.classList.remove("hidden")}),1500)}async function submitResponse(){const e=document.getElementById("category").value,t=document.getElementById("question").value,n=localStorage.getItem("current_user"),s=document.getElementById("feedback").value||"";if(!n)return alert("User name is missing! Please refresh and re-enter your name.");if(!e||!t)return alert("Please select a category and a question before proceeding.");let o=0;patientReadStartTime&&(o=(new Date-patientReadStartTime)/1e3,localStorage.setItem("read_to_response_time",o.toFixed(2)),patientReadStartTime=null);const a=localStorage.getItem("question_selection_time")||"",i=await fetch("https://big5-wish.onrender.com/submit_response",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,patient_statement:patientStatements[currentIndex],category:e,selected_question:t,dropdown_time:a,response_time:o.toFixed(2),feedback:s})}),d=await i.json();showMemeOverlay(),d.success?(currentIndex++,updateStatement(),document.getElementById("feedback").value=""):alert("Error submitting response: "+d.message)}const questionDropdown=document.getElementById("question");questionDropdown.addEventListener("mousedown",(()=>{questionOpenTime=new Date})),questionDropdown.addEventListener("change",(()=>{if(questionOpenTime){const e=(new Date-questionOpenTime)/1e3;localStorage.setItem("question_selection_time",e.toFixed(2)),questionOpenTime=null}}));const memes=[{src:"/memes/20.png",text:"Filling forms for free like a true unsung hero. 🫡"},{src:"/memes/1.png",text:"You’re doing great sweetie… this survey was made for you. 🔥"},{src:"/memes/3.png",text:"That answer hit harder than student debt."},{src:"/memes/5.png",text:"Me judging your response... and lowkey admiring it."},{src:"/memes/4.png",text:"Free survey. No coffee, no cash. Just good vibes and moral superiority. ☕✨"},{src:"/memes/6.png",text:"You answered that like you’ve been professionally overthinking for years."},{src:"/memes/8.png",text:"This cat saw your answer and started rethinking its life choices."},{src:"/memes/2.png",text:"That response? Straight from the ‘I overanalyze everything’ vault."},{src:"/memes/9.png",text:"You’re radiating butterfly energy and trauma wisdom rn."},{src:"/memes/10.png",text:"You deserve a hot drink for that kind of self-reflection. ☕🐱"},{src:"/memes/7.png",text:"This face says it all: impressed, but deeply confused by how real that was."},{src:"/memes/19.png",text:"Stop. Just stop. That answer was *too* good. 🛑"},{src:"/memes/16.png",text:"Very thoughts. Much depth. So psychology. 🧠"},{src:"/memes/11.png",text:"Remember: if you don’t know the answer, say it confidently anyway. 🤓"},{src:"/memes/12.png",text:"Sprinkling truth like Salt Bae and making us reflect."},{src:"/memes/13.png",text:"Leo approves. And he’s picky. 👏"},{src:"/memes/14.png",text:"You just shut down that inner critic like a boss. 🎤"},{src:"/memes/15.png",text:"That was so good, Rick wants to clone your brain."},{src:"/memes/17.png",text:"Your brain after finishing one deep question: ‘I'm done.’ But you’re not."},{src:"/memes/18.png",text:"That moment when you realize this form helps you to become a better friend now."}];let memeSequence=[...memes],memeIndex=0,nextMeme=null;function setMeme(){if(memeIndex>=memeSequence.length)return;nextMeme=memeSequence[memeIndex++];(new Image).src=nextMeme.src;const e=document.getElementById("memeImage"),t=document.getElementById("memeText");e.src=nextMeme.src,t.textContent=nextMeme.text}function showMemeOverlay(){if(!nextMeme)return;const e=document.getElementById("memeOverlay");e.classList.remove("hidden"),setTimeout((()=>{e.classList.add("hidden"),setMeme()}),4500)}!function(){for(let e=memeSequence.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[memeSequence[e],memeSequence[t]]=[memeSequence[t],memeSequence[e]]}}();